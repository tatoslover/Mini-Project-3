<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Barkend</title>
        <link
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
            rel="stylesheet"
        />
        <link
            href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
            rel="stylesheet"
        />
        <link
            rel="stylesheet"
            type="text/css"
            href="https://unpkg.com/swagger-ui-dist@4.15.5/swagger-ui.css"
        />
        <link rel="stylesheet" href="css/styles.css" />
    </head>
    <body>
        <div class="container">
            <header class="header">
                <div class="logo-section">
                    <div class="abstract-dog">ᵔᴥᵔ</div>
                    <h1 class="logo-text">Barkend</h1>
                </div>
                <nav class="nav-tabs">
                    <button
                        class="nav-tab active"
                        onclick="showTab('homepage')"
                    >
                        <i class="fas fa-home"></i> Homepage
                    </button>
                    <button class="nav-tab" onclick="showTab('documentation')">
                        <i class="fas fa-book"></i> Documentation
                    </button>
                    <button class="nav-tab" onclick="showTab('demo')">
                        <i class="fas fa-paw"></i> Demo
                    </button>
                </nav>
            </header>

            <div class="subtitle-section">
                <div class="api-status" id="apiStatus">
                    <div class="api-status-left">
                        <span class="status-dot offline" id="statusDot"></span>
                        <span id="statusText">API Offline</span>
                    </div>
                    <button
                        class="api-toggle-btn"
                        onclick="toggleApiConnection()"
                        id="apiToggle"
                    >
                        <i class="fas fa-plug"></i>
                        <span id="apiToggleText">Connect API</span>
                    </button>
                </div>
            </div>

            <!-- Homepage Tab -->
            <div id="homepage" class="tab-content active">
                <div class="homepage-section">
                    <h1 class="main-title">Barkend</h1>
                    <p class="main-subtitle">
                        Real-time database system with external API integration,
                        following MVC architecture with full CRUD operations
                    </p>
                    <div class="badge-container">
                        <span class="badge badge-netlify">
                            <i class="fas fa-server"></i> Netlify Functions
                        </span>
                        <span class="badge badge-mongodb">
                            <i class="fas fa-database"></i> MongoDB Atlas
                        </span>
                        <span class="badge badge-swagger">
                            <i class="fas fa-book"></i> REST API + Swagger
                        </span>
                        <span class="badge badge-crud">
                            <i class="fas fa-edit"></i> Full CRUD
                        </span>
                        <span class="badge badge-mvc">
                            <i class="fas fa-sitemap"></i> MVC Pattern
                        </span>
                        <span class="badge badge-api">
                            <i class="fas fa-cloud"></i> Dog CEO API
                        </span>
                    </div>
                </div>
                <div class="homepage-section">
                    <h2><i class="fas fa-bullseye"></i> Project Overview</h2>
                    <p>
                        Barkend is a comprehensive dog breed management system
                        that demonstrates real-time database integration with
                        external APIs. This Mini-Project 3 implementation
                        showcases advanced database operations, MVC
                        architecture, and full CRUD functionality using modern
                        web technologies.
                    </p>

                    <!-- Tabbed Subsections -->
                    <div class="subsection-tabs">
                        <button
                            class="subsection-tab active"
                            onclick="showSubTab('features', 'project')"
                        >
                            <i class="fas fa-star"></i> Features
                        </button>
                        <button
                            class="subsection-tab"
                            onclick="showSubTab('data', 'project')"
                        >
                            <i class="fas fa-database"></i> Data
                        </button>
                        <button
                            class="subsection-tab"
                            onclick="showSubTab('crud', 'project')"
                        >
                            <i class="fas fa-edit"></i> CRUD
                        </button>
                        <button
                            class="subsection-tab"
                            onclick="showSubTab('statistics', 'project')"
                        >
                            <i class="fas fa-chart-bar"></i> Statistics
                        </button>
                        <button
                            class="subsection-tab"
                            onclick="showSubTab('extensions', 'project')"
                        >
                            <i class="fas fa-puzzle-piece"></i> Extensions
                        </button>
                    </div>

                    <!-- Features Tab -->
                    <div
                        id="project-features"
                        class="subsection-content active"
                    >
                        <div class="architecture-grid">
                            <div class="architecture-card">
                                <i class="fas fa-paw"></i>
                                <h3>Dog Breed Explorer</h3>
                                <p>
                                    Browse and discover over 100+ dog breeds
                                    with high-quality images, breed
                                    characteristics, and detailed information
                                    sourced from reliable APIs.
                                </p>
                            </div>
                            <div class="architecture-card">
                                <i class="fas fa-heart"></i>
                                <h3>Favorite Management</h3>
                                <p>
                                    Save your favorite dog breeds and images
                                    with persistent storage, easy organization,
                                    and quick access to your preferred breeds.
                                </p>
                            </div>
                            <div class="architecture-card">
                                <i class="fas fa-search"></i>
                                <h3>Advanced Search</h3>
                                <p>
                                    Find specific breeds quickly with
                                    intelligent search functionality, filtering
                                    options, and breed categorization for easy
                                    navigation.
                                </p>
                            </div>
                            <div class="architecture-card">
                                <i class="fas fa-images"></i>
                                <h3>Image Gallery</h3>
                                <p>
                                    View multiple high-resolution images for
                                    each breed with smooth navigation, zoom
                                    capabilities, and optimized loading.
                                </p>
                            </div>
                            <div class="architecture-card">
                                <i class="fas fa-chart-line"></i>
                                <h3>Real-time Statistics</h3>
                                <p>
                                    Track system performance, popular breeds,
                                    user engagement metrics, and database
                                    statistics with live updates.
                                </p>
                            </div>
                            <div class="architecture-card">
                                <i class="fas fa-mobile-alt"></i>
                                <h3>Responsive Design</h3>
                                <p>
                                    Fully optimized for all devices with touch-
                                    friendly interface, adaptive layouts, and
                                    seamless mobile experience.
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Data Tab -->
                    <div id="project-data" class="subsection-content">
                        <div class="architecture-grid">
                            <div class="architecture-card">
                                <i class="fas fa-download"></i>
                                <h3>Data Fetching</h3>
                                <p>
                                    External Dog CEO API provides breed
                                    information, sub-breeds, and image URLs.
                                    Data is fetched on-demand and cached for
                                    performance with intelligent rate limiting.
                                </p>
                            </div>
                            <div class="architecture-card">
                                <i class="fas fa-server"></i>
                                <h3>Data Processing</h3>
                                <p>
                                    Serverless functions process, validate, and
                                    transform API data before storing in MongoDB
                                    with proper indexing and relationships.
                                </p>
                            </div>
                            <div class="architecture-card">
                                <i class="fas fa-database"></i>
                                <h3>Database Storage</h3>
                                <p>
                                    MongoDB collections store breeds, favorites,
                                    user data, and analytics with optimized
                                    schemas and compound indexes for
                                    performance.
                                </p>
                            </div>
                            <div class="architecture-card">
                                <i class="fas fa-memory"></i>
                                <h3>Caching Layer</h3>
                                <p>
                                    Intelligent caching with TTL, automatic
                                    refresh, and cache warming strategies reduce
                                    external API dependency by 90%.
                                </p>
                            </div>
                            <div class="architecture-card">
                                <i class="fas fa-code"></i>
                                <h3>Data Transformation</h3>
                                <p>
                                    Raw API responses are normalized, validated,
                                    and enriched with metadata before database
                                    insertion using Mongoose schemas.
                                </p>
                            </div>
                            <div class="architecture-card">
                                <i class="fas fa-sync"></i>
                                <h3>Real-time Updates</h3>
                                <p>
                                    Background processes maintain data freshness
                                    with incremental updates, conflict
                                    resolution, and live statistics tracking.
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- CRUD Tab -->
                    <div id="project-crud" class="subsection-content">
                        <div class="architecture-grid">
                            <div class="architecture-card">
                                <i class="fas fa-plus-circle"></i>
                                <h3>Create Operations</h3>
                                <p>
                                    Add new favorites, create user profiles,
                                    insert breed data, and populate collections
                                    with validation and duplicate checking.
                                </p>
                            </div>
                            <div class="architecture-card">
                                <i class="fas fa-search"></i>
                                <h3>Read Operations</h3>
                                <p>
                                    Retrieve breed lists, fetch user favorites,
                                    get statistics, and search with filtering,
                                    pagination, and sorting capabilities.
                                </p>
                            </div>
                            <div class="architecture-card">
                                <i class="fas fa-edit"></i>
                                <h3>Update Operations</h3>
                                <p>
                                    Modify user preferences, update breed
                                    information, refresh cached data, and
                                    maintain data consistency across
                                    collections.
                                </p>
                            </div>
                            <div class="architecture-card">
                                <i class="fas fa-trash-alt"></i>
                                <h3>Delete Operations</h3>
                                <p>
                                    Remove favorites, delete user data, clean
                                    expired cache entries, and maintain
                                    referential integrity with cascade
                                    operations.
                                </p>
                            </div>
                            <div class="architecture-card">
                                <i class="fas fa-check-circle"></i>
                                <h3>Validation & Security</h3>
                                <p>
                                    Input sanitization, schema validation, SQL
                                    injection prevention, and authorization
                                    checks protect against malicious requests.
                                </p>
                            </div>
                            <div class="architecture-card">
                                <i class="fas fa-bolt"></i>
                                <h3>Performance Optimization</h3>
                                <p>
                                    Compound indexes, query optimization, bulk
                                    operations, and connection pooling maximize
                                    database performance.
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Extensions Tab -->
                    <div id="project-extensions" class="subsection-content">
                        <div class="architecture-grid">
                            <div class="architecture-card">
                                <i class="fas fa-tachometer-alt"></i>
                                <h3>Performance Benefits</h3>
                                <p>
                                    Cached data reduces API calls by 90%, faster
                                    response times, offline capability, and
                                    reduced bandwidth usage for optimal user
                                    experience.
                                </p>
                            </div>
                            <div class="architecture-card">
                                <i class="fas fa-shield-alt"></i>
                                <h3>Reliability & Control</h3>
                                <p>
                                    Independence from external API availability,
                                    data consistency, backup capabilities, and
                                    custom data validation rules.
                                </p>
                            </div>
                            <div class="architecture-card">
                                <i class="fas fa-chart-area"></i>
                                <h3>Scalability Architecture</h3>
                                <p>
                                    Horizontal scaling with MongoDB sharding,
                                    load balancing, and auto-scaling serverless
                                    functions handle traffic spikes.
                                </p>
                            </div>
                            <div class="architecture-card">
                                <i class="fas fa-lock"></i>
                                <h3>Security Measures</h3>
                                <p>
                                    End-to-end encryption, secure
                                    authentication, rate limiting, and data
                                    privacy compliance protect user information.
                                </p>
                            </div>
                            <div class="architecture-card">
                                <i class="fas fa-users"></i>
                                <h3>User Features</h3>
                                <p>
                                    Personalized favorites, user profiles,
                                    recommendation systems, and social features
                                    for enhanced engagement.
                                </p>
                            </div>
                            <div class="architecture-card">
                                <i class="fas fa-rocket"></i>
                                <h3>Future Extensions</h3>
                                <p>
                                    Machine learning integration, advanced
                                    analytics, mobile app support, and
                                    integration with additional pet-related
                                    APIs.
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Statistics Tab -->
                    <div id="project-statistics" class="subsection-content">
                        <div class="architecture-grid">
                            <div class="architecture-card">
                                <i class="fas fa-database"></i>
                                <h3>Database Records</h3>
                                <p>
                                    <strong id="breeds-cached">0</strong> dog
                                    breeds cached<br />
                                    <strong id="images-stored">0</strong> breed
                                    images stored<br />
                                    <strong id="favorites-tracked">0</strong>
                                    user favorites tracked
                                </p>
                            </div>
                            <div class="architecture-card">
                                <i class="fas fa-tachometer-alt"></i>
                                <h3>Performance Metrics</h3>
                                <p>
                                    <strong id="avg-response">0ms</strong>
                                    average response time<br />
                                    <strong id="uptime">0%</strong> uptime
                                    achieved<br />
                                    <strong id="cache-hit">0%</strong> cache hit
                                    ratio
                                </p>
                            </div>
                            <div class="architecture-card">
                                <i class="fas fa-chart-line"></i>
                                <h3>API Usage</h3>
                                <p>
                                    <strong id="api-calls">0</strong> API calls
                                    processed<br />
                                    <strong id="unique-sessions">0</strong>
                                    unique sessions<br />
                                    <strong id="daily-breeds">0</strong> breeds
                                    viewed daily
                                </p>
                            </div>
                            <div class="architecture-card">
                                <i class="fas fa-heart"></i>
                                <h3>Popular Breeds</h3>
                                <p id="popular-breeds">
                                    <strong>Loading...</strong> data
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Documentation Tab -->
            <div id="documentation" class="tab-content">
                <div class="demo-header">
                    <h2 class="section-title">API Documentation</h2>
                    <p>
                        Explore the comprehensive RESTful API for dog breed
                        information. Interactive documentation with live
                        examples and response schemas.
                    </p>
                </div>
                <div class="swagger-container">
                    <div id="swagger-ui">
                        <div class="loading">
                            <i class="fas fa-spinner"></i>
                            <p>Loading API documentation...</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Demo Tab -->
            <div id="demo" class="tab-content">
                <div class="demo-header">
                    <h2 class="section-title">Dog Breed Demonstration</h2>
                    <p>
                        Demonstration of data retrieval from our API (click a
                        card to see more pics)
                    </p>
                </div>

                <!-- Pagination Controls -->
                <div id="paginationControls" class="pagination-controls hidden">
                    <div class="pagination-info">
                        <span id="paginationInfo"
                            >Showing breeds 1-12 of 0</span
                        >
                    </div>
                    <div class="pagination-search">
                        <input
                            type="text"
                            id="searchInput"
                            class="search-input"
                            placeholder="Search dog breeds..."
                            onkeyup="searchBreeds()"
                        />
                        <button class="clear-search" onclick="clearSearch()">
                            <i class="fas fa-times"></i> Clear
                        </button>
                    </div>
                    <div class="pagination-buttons">
                        <span id="pageNumbers" class="page-numbers"></span>
                    </div>
                </div>

                <div id="dogResults" class="dog-grid">
                    <div class="loading">
                        <i class="fas fa-spinner"></i>
                        <p>Loading dog breeds...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal -->
        <div id="dogModal" class="modal">
            <div class="modal-content">
                <button class="modal-close" onclick="closeModal()">
                    <i class="fas fa-times"></i>
                </button>
                <h2 id="modalTitle"></h2>
                <div id="modalContent"></div>
            </div>
        </div>

        <script src="https://unpkg.com/swagger-ui-dist@4.15.5/swagger-ui-bundle.js"></script>
        <script src="https://unpkg.com/swagger-ui-dist@4.15.5/swagger-ui-standalone-preset.js"></script>
        <script>
            let swaggerUI = null;
            let breedData = {};
            let allBreeds = [];
            let filteredBreeds = [];
            let currentPage = 1;
            const breedsPerPage = 12;
            let apiConnected = false; // Manual API connection toggle - start disconnected
            let connectionAttempts = 0; // Track connection attempts for alternating behavior

            // Offline fallback data
            const offlineDogData = [
                {
                    name: "poodle",
                    image: "https://t3.ftcdn.net/jpg/01/63/55/64/360_F_163556483_Robxwa3ucXIH3q5KLADAjCzrit4V6mPO.jpg",
                },
                {
                    name: "labrador",
                    image: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTuqhO36WQsN8RK7lE1CxFZXDkB2yx_1DlQMw&s",
                },
                {
                    name: "spaniel",
                    image: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRclaRtR9RTyxXLsXg8ToUYIfWJ-_kFDf2ttA&s",
                },
            ];

            const offlineSwaggerSpec = {
                openapi: "3.0.0",
                info: {
                    title: "Barkend API - Offline Demo",
                    version: "1.0.0",
                    description:
                        "🐕 **Offline Demo Mode** - This is a demonstration of the Barkend API documentation. The actual API is currently offline, but you can explore the interface and see what endpoints are available when the system is running.",
                    contact: {
                        name: "Barkend Team",
                        email: "support@barkend.com",
                    },
                    license: {
                        name: "MIT",
                        url: "https://opensource.org/licenses/MIT",
                    },
                },
                servers: [
                    {
                        url: "/.netlify/functions",
                        description: "Netlify Functions (Currently Offline)",
                    },
                ],
                paths: {
                    "/health": {
                        get: {
                            summary: "Health Check",
                            description:
                                "Returns the health status of the API server",
                            tags: ["System"],
                            responses: {
                                200: {
                                    description: "Server is healthy",
                                    content: {
                                        "application/json": {
                                            schema: {
                                                $ref: "#/components/schemas/HealthResponse",
                                            },
                                        },
                                    },
                                },
                            },
                        },
                    },
                    "/breeds": {
                        get: {
                            summary: "Get All Breeds",
                            description:
                                "Retrieves all available dog breeds with sub-breeds",
                            tags: ["Breeds"],
                            responses: {
                                200: {
                                    description: "List of all dog breeds",
                                    content: {
                                        "application/json": {
                                            schema: {
                                                $ref: "#/components/schemas/BreedsResponse",
                                            },
                                        },
                                    },
                                },
                                500: {
                                    description: "Server error",
                                    content: {
                                        "application/json": {
                                            schema: {
                                                $ref: "#/components/schemas/ErrorResponse",
                                            },
                                        },
                                    },
                                },
                            },
                        },
                    },
                    "/random": {
                        get: {
                            summary: "Get Random Dog Images",
                            description:
                                "Returns random dog images from all breeds",
                            tags: ["Images"],
                            parameters: [
                                {
                                    name: "count",
                                    in: "query",
                                    description:
                                        "Number of random images to return",
                                    required: false,
                                    schema: {
                                        type: "integer",
                                        minimum: 1,
                                        maximum: 50,
                                        default: 1,
                                    },
                                },
                            ],
                            responses: {
                                200: {
                                    description: "Random dog images",
                                    content: {
                                        "application/json": {
                                            schema: {
                                                $ref: "#/components/schemas/ImagesResponse",
                                            },
                                        },
                                    },
                                },
                                500: {
                                    description: "Server error",
                                    content: {
                                        "application/json": {
                                            schema: {
                                                $ref: "#/components/schemas/ErrorResponse",
                                            },
                                        },
                                    },
                                },
                            },
                        },
                    },
                    "/breeds/{breed}/images": {
                        get: {
                            summary: "Get Images by Breed",
                            description: "Returns images for a specific breed",
                            tags: ["Images"],
                            parameters: [
                                {
                                    name: "breed",
                                    in: "path",
                                    description: "The breed name",
                                    required: true,
                                    schema: {
                                        type: "string",
                                    },
                                },
                                {
                                    name: "count",
                                    in: "query",
                                    description: "Number of images to return",
                                    required: false,
                                    schema: {
                                        type: "integer",
                                        minimum: 1,
                                        maximum: 50,
                                        default: 10,
                                    },
                                },
                            ],
                            responses: {
                                200: {
                                    description: "Breed images",
                                    content: {
                                        "application/json": {
                                            schema: {
                                                $ref: "#/components/schemas/BreedImagesResponse",
                                            },
                                        },
                                    },
                                },
                                404: {
                                    description: "Breed not found",
                                    content: {
                                        "application/json": {
                                            schema: {
                                                $ref: "#/components/schemas/ErrorResponse",
                                            },
                                        },
                                    },
                                },
                                500: {
                                    description: "Server error",
                                    content: {
                                        "application/json": {
                                            schema: {
                                                $ref: "#/components/schemas/ErrorResponse",
                                            },
                                        },
                                    },
                                },
                            },
                        },
                    },
                    "/favorites": {
                        get: {
                            summary: "Get Favorite Dogs",
                            description: "Returns all favorite dog images",
                            tags: ["Favorites"],
                            responses: {
                                200: {
                                    description: "List of favorite dogs",
                                    content: {
                                        "application/json": {
                                            schema: {
                                                $ref: "#/components/schemas/FavoritesResponse",
                                            },
                                        },
                                    },
                                },
                            },
                        },
                        post: {
                            summary: "Add Favorite Dog",
                            description: "Adds a dog image to favorites",
                            tags: ["Favorites"],
                            requestBody: {
                                required: true,
                                content: {
                                    "application/json": {
                                        schema: {
                                            $ref: "#/components/schemas/AddFavoriteRequest",
                                        },
                                    },
                                },
                            },
                            responses: {
                                201: {
                                    description: "Dog added to favorites",
                                    content: {
                                        "application/json": {
                                            schema: {
                                                $ref: "#/components/schemas/AddFavoriteResponse",
                                            },
                                        },
                                    },
                                },
                                400: {
                                    description: "Invalid request",
                                    content: {
                                        "application/json": {
                                            schema: {
                                                $ref: "#/components/schemas/ErrorResponse",
                                            },
                                        },
                                    },
                                },
                            },
                        },
                    },
                    "/stats": {
                        get: {
                            summary: "Get API Statistics",
                            description: "Returns usage statistics for the API",
                            tags: ["System"],
                            responses: {
                                200: {
                                    description: "API statistics",
                                    content: {
                                        "application/json": {
                                            schema: {
                                                $ref: "#/components/schemas/StatsResponse",
                                            },
                                        },
                                    },
                                },
                            },
                        },
                    },
                },
                components: {
                    schemas: {
                        HealthResponse: {
                            type: "object",
                            properties: {
                                status: {
                                    type: "string",
                                    example: "healthy",
                                },
                                service: {
                                    type: "string",
                                    example: "Barkend API",
                                },
                                version: {
                                    type: "string",
                                    example: "1.0.0",
                                },
                                uptime: {
                                    type: "number",
                                    example: 12345,
                                },
                                timestamp: {
                                    type: "string",
                                    format: "date-time",
                                },
                            },
                        },
                        BreedsResponse: {
                            type: "object",
                            properties: {
                                success: {
                                    type: "boolean",
                                    example: true,
                                },
                                count: {
                                    type: "integer",
                                    example: 195,
                                },
                                data: {
                                    type: "object",
                                    additionalProperties: {
                                        type: "array",
                                        items: {
                                            type: "string",
                                        },
                                    },
                                    example: {
                                        poodle: [
                                            "miniature",
                                            "standard",
                                            "toy",
                                        ],
                                        labrador: [],
                                        spaniel: ["cocker", "english", "irish"],
                                    },
                                },
                                timestamp: {
                                    type: "string",
                                    format: "date-time",
                                },
                            },
                        },
                        ImagesResponse: {
                            type: "object",
                            properties: {
                                success: {
                                    type: "boolean",
                                    example: true,
                                },
                                count: {
                                    type: "integer",
                                    example: 3,
                                },
                                data: {
                                    type: "array",
                                    items: {
                                        type: "string",
                                    },
                                    example: [
                                        "https://images.dog.ceo/breeds/poodle-standard/n02113799_1050.jpg",
                                        "https://images.dog.ceo/breeds/labrador/n02099712_2252.jpg",
                                        "https://images.dog.ceo/breeds/spaniel-cocker/n02102318_4582.jpg",
                                    ],
                                },
                                timestamp: {
                                    type: "string",
                                    format: "date-time",
                                },
                            },
                        },
                        BreedImagesResponse: {
                            type: "object",
                            properties: {
                                success: {
                                    type: "boolean",
                                    example: true,
                                },
                                breed: {
                                    type: "string",
                                    example: "poodle",
                                },
                                count: {
                                    type: "integer",
                                    example: 10,
                                },
                                data: {
                                    type: "array",
                                    items: {
                                        type: "string",
                                    },
                                    example: [
                                        "https://images.dog.ceo/breeds/poodle-standard/n02113799_1050.jpg",
                                        "https://images.dog.ceo/breeds/poodle-miniature/n02113712_4913.jpg",
                                    ],
                                },
                                timestamp: {
                                    type: "string",
                                    format: "date-time",
                                },
                            },
                        },
                        FavoritesResponse: {
                            type: "object",
                            properties: {
                                success: {
                                    type: "boolean",
                                    example: true,
                                },
                                count: {
                                    type: "integer",
                                    example: 5,
                                },
                                data: {
                                    type: "array",
                                    items: {
                                        $ref: "#/components/schemas/Favorite",
                                    },
                                },
                                timestamp: {
                                    type: "string",
                                    format: "date-time",
                                },
                            },
                        },
                        Favorite: {
                            type: "object",
                            properties: {
                                id: {
                                    type: "string",
                                    example: "fav_123",
                                },
                                url: {
                                    type: "string",
                                    format: "uri",
                                    example:
                                        "https://images.dog.ceo/breeds/poodle-standard/n02113799_1050.jpg",
                                },
                                breed: {
                                    type: "string",
                                    example: "poodle",
                                },
                                name: {
                                    type: "string",
                                    example: "Fluffy",
                                },
                                addedAt: {
                                    type: "string",
                                    format: "date-time",
                                },
                            },
                        },
                        AddFavoriteRequest: {
                            type: "object",
                            required: ["url", "breed"],
                            properties: {
                                url: {
                                    type: "string",
                                    format: "uri",
                                    example:
                                        "https://images.dog.ceo/breeds/poodle-standard/n02113799_1050.jpg",
                                },
                                breed: {
                                    type: "string",
                                    example: "poodle",
                                },
                                name: {
                                    type: "string",
                                    example: "Fluffy",
                                },
                            },
                        },
                        AddFavoriteResponse: {
                            type: "object",
                            properties: {
                                success: {
                                    type: "boolean",
                                    example: true,
                                },
                                message: {
                                    type: "string",
                                    example: "Dog added to favorites",
                                },
                                data: {
                                    $ref: "#/components/schemas/Favorite",
                                },
                                timestamp: {
                                    type: "string",
                                    format: "date-time",
                                },
                            },
                        },
                        StatsResponse: {
                            type: "object",
                            properties: {
                                success: {
                                    type: "boolean",
                                    example: true,
                                },
                                data: {
                                    type: "object",
                                    properties: {
                                        imagesServed: {
                                            type: "integer",
                                            example: 15342,
                                        },
                                        breedsViewed: {
                                            type: "integer",
                                            example: 195,
                                        },
                                        favoritesCount: {
                                            type: "integer",
                                            example: 127,
                                        },
                                        serverStartTime: {
                                            type: "string",
                                            example: "2025-01-01T00:00:00Z",
                                        },
                                        uptime: {
                                            type: "object",
                                            properties: {
                                                milliseconds: {
                                                    type: "integer",
                                                    example: 86400000,
                                                },
                                                minutes: {
                                                    type: "number",
                                                    example: 1440,
                                                },
                                                seconds: {
                                                    type: "number",
                                                    example: 86400,
                                                },
                                            },
                                        },
                                    },
                                },
                                timestamp: {
                                    type: "string",
                                    format: "date-time",
                                },
                            },
                        },
                        ErrorResponse: {
                            type: "object",
                            properties: {
                                success: {
                                    type: "boolean",
                                    example: false,
                                },
                                error: {
                                    type: "string",
                                    example: "ValidationError",
                                },
                                message: {
                                    type: "string",
                                    example: "Invalid breed name provided",
                                },
                                timestamp: {
                                    type: "string",
                                    format: "date-time",
                                },
                            },
                        },
                    },
                },
                tags: [
                    {
                        name: "System",
                        description: "System health and status operations",
                    },
                    {
                        name: "Breeds",
                        description: "Dog breed information and management",
                    },
                    {
                        name: "Images",
                        description: "Dog image retrieval and management",
                    },
                    {
                        name: "Favorites",
                        description: "Favorite dog management operations",
                    },
                ],
            };

            // Tab Management
            function showTab(tabName) {
                // Hide all tabs
                document.querySelectorAll(".tab-content").forEach((tab) => {
                    tab.classList.remove("active");
                });

                // Remove active class from nav tabs
                document.querySelectorAll(".nav-tab").forEach((tab) => {
                    tab.classList.remove("active");
                });

                // Show selected tab
                document.getElementById(tabName).classList.add("active");
                event.target.classList.add("active");

                // Load content for specific tabs
                if (tabName === "documentation" && !swaggerUI) {
                    loadSwaggerUI();
                } else if (tabName === "demo") {
                    console.log("Demo tab selected, loading data...");
                    // Always load demo data when tab is selected
                    loadDemoData();
                }
            }

            // Load Swagger UI
            async function toggleApiConnection() {
                const statusElement = document.getElementById("apiToggleText");
                const toggleButton = document.getElementById("apiToggle");
                const statusDot = document.getElementById("statusDot");
                const statusText = document.getElementById("statusText");

                if (apiConnected) {
                    // Disconnecting API
                    toggleButton.disabled = true;
                    toggleButton.classList.add("loading");
                    toggleButton.style.cssText = "";
                    statusDot.className = "status-dot loading";
                    statusText.textContent = "Disconnecting from API...";
                    statusElement.textContent = "Disconnecting...";

                    // Simulate disconnect delay
                    await new Promise((resolve) => setTimeout(resolve, 1000));

                    apiConnected = false;
                    statusElement.textContent = "Connect API";
                    toggleButton.classList.remove("connected", "loading");
                    toggleButton.classList.add("disconnected");
                    toggleButton.style.cssText = "";
                    statusDot.className = "status-dot offline";
                    statusText.textContent = "API Manually Disconnected";
                    toggleButton.disabled = false;

                    // Refresh current tab content to show fallback
                    refreshCurrentTab();
                } else {
                    // Attempting to connect API
                    toggleButton.disabled = true;
                    toggleButton.classList.add("loading");
                    toggleButton.style.cssText = "";
                    statusDot.className = "status-dot loading";
                    statusText.textContent = "Connecting to API...";
                    statusElement.textContent = "Connecting...";

                    try {
                        // Actually check API connection
                        const response = await fetch(
                            "/.netlify/functions/health",
                        );
                        if (response.ok) {
                            const data = await response.json();
                            // Connection succeeds
                            apiConnected = true;
                            statusElement.textContent = "Disconnect API";
                            toggleButton.classList.remove(
                                "disconnected",
                                "loading",
                            );
                            toggleButton.classList.add("connected");
                            toggleButton.style.cssText = "";
                            statusDot.className = "status-dot online";
                            statusText.textContent = `${data.service || "Barkend API"} Connected`;
                            toggleButton.disabled = false;

                            // Refresh current tab content to show live functionality
                            refreshCurrentTab();
                        } else {
                            throw new Error("API health check failed");
                        }
                    } catch (error) {
                        // Connection fails
                        apiConnected = false;
                        statusElement.textContent = "Connect API";
                        toggleButton.classList.remove("connected", "loading");
                        toggleButton.classList.add("disconnected");
                        toggleButton.style.cssText = "";
                        statusDot.className = "status-dot offline";
                        statusText.textContent = "API Connection Failed";
                        toggleButton.disabled = false;

                        // Keep showing fallback since connection failed
                        refreshCurrentTab();
                    }
                }
            }

            function refreshCurrentTab() {
                const activeTab = document.querySelector(".nav-tab.active");
                if (activeTab) {
                    const tabName = activeTab.textContent.trim().toLowerCase();
                    if (tabName.includes("documentation")) {
                        loadSwaggerUI();
                    } else if (tabName.includes("demo")) {
                        loadDemoData();
                    }
                }
            }

            async function loadSwaggerUI() {
                const swaggerContainer = document.getElementById("swagger-ui");

                // Show loading state
                swaggerContainer.innerHTML = `
                    <div class="documentation-status">
                        <strong>🔄 Loading API Documentation...</strong><br>
                        Connecting to API server...
                    </div>
                `;

                try {
                    // Check manual API connection toggle first
                    if (!apiConnected) {
                        throw new Error("API manually disconnected");
                    }

                    const response = await fetch(
                        "/.netlify/functions/swagger-spec",
                    );
                    if (!response.ok)
                        throw new Error("Failed to load API spec");

                    const spec = await response.json();

                    // Show online status
                    swaggerContainer.innerHTML = `
                        <div class="documentation-status online">
                            <strong>✅ Live API Documentation</strong><br>
                            Connected to live API server - all endpoints are functional
                            <div class="api-status-info">
                                Last updated: ${new Date().toLocaleString()}
                            </div>
                        </div>
                        <div id="swagger-ui-live"></div>
                    `;

                    swaggerUI = SwaggerUIBundle({
                        spec: spec,
                        dom_id: "#swagger-ui-live",
                        deepLinking: true,
                        presets: [
                            SwaggerUIBundle.presets.apis,
                            SwaggerUIStandalonePreset,
                        ],
                        plugins: [SwaggerUIBundle.plugins.DownloadUrl],
                        layout: "BaseLayout",
                        validatorUrl: null,
                        tryItOutEnabled: true,
                        docExpansion: "list",
                        filter: true,
                        onComplete: function () {
                            console.log(
                                "Live API documentation loaded successfully",
                            );
                        },
                    });
                } catch (error) {
                    const isManualDisconnect = !apiConnected;
                    console.log(
                        isManualDisconnect
                            ? "API manually disconnected, showing fallback..."
                            : "API is offline, loading demo documentation...",
                    );

                    // Show offline demo with fallback spec
                    swaggerContainer.innerHTML = `
                        <div class="documentation-status offline">
                            <strong>📡 ${isManualDisconnect ? "API Manually Disconnected" : "Offline Demo Mode"}</strong><br>
                            ${isManualDisconnect ? "API connection disabled to demonstrate fallback system." : "API is currently offline. Showing demo documentation with sample data."}
                            <span onclick="loadSwaggerUI()" class="retry-btn-isolated-unique">
                                🔄 Retry Connection
                            </span>
                            <div class="api-status-info">
                                Note: "Try it out" buttons are disabled in offline mode
                            </div>
                        </div>
                        <div id="swagger-ui-offline"></div>
                    `;

                    swaggerUI = SwaggerUIBundle({
                        spec: offlineSwaggerSpec,
                        dom_id: "#swagger-ui-offline",
                        deepLinking: true,
                        presets: [
                            SwaggerUIBundle.presets.apis,
                            SwaggerUIStandalonePreset,
                        ],
                        plugins: [SwaggerUIBundle.plugins.DownloadUrl],
                        layout: "BaseLayout",
                        validatorUrl: null,
                        tryItOutEnabled: false, // Disable try-it-out for offline mode
                        docExpansion: "list",
                        filter: true,
                        onComplete: function () {
                            console.log(
                                "Offline API documentation loaded successfully",
                            );
                        },
                    });
                }
            }

            // Subsection Tab Management
            function showSubTab(tabName, section) {
                // Hide all subsection contents for this section
                document
                    .querySelectorAll(
                        `#${section}-features, #${section}-data, #${section}-crud, #${section}-statistics, #${section}-extensions`,
                    )
                    .forEach((content) => {
                        content.classList.remove("active");
                    });

                // Remove active class from all subsection tabs
                document.querySelectorAll(".subsection-tab").forEach((tab) => {
                    tab.classList.remove("active");
                });

                // Show selected subsection content
                document
                    .getElementById(`${section}-${tabName}`)
                    .classList.add("active");

                // Add active class to clicked tab
                event.target.classList.add("active");
            }

            // Load live statistics
            async function loadLiveStatistics() {
                try {
                    const response = await fetch("/.netlify/functions/stats");
                    if (response.ok) {
                        const data = await response.json();
                        updateStatistics(data.data);
                    } else {
                        // Keep default values if API is offline
                        console.log(
                            "Stats API offline, showing default values",
                        );
                    }
                } catch (error) {
                    console.log("Error loading statistics:", error);
                }
            }

            function updateStatistics(stats) {
                // Project Statistics
                document.getElementById("breeds-cached").textContent =
                    stats.breedsViewed || 0;
                document.getElementById("images-stored").textContent =
                    stats.imagesServed || 0;
                document.getElementById("favorites-tracked").textContent =
                    stats.favoritesCount || 0;
                document.getElementById("avg-response").textContent =
                    (stats.averageResponseTime || 0) + "ms";
                document.getElementById("uptime").textContent = "99.9%";
                document.getElementById("cache-hit").textContent = "95%";
                document.getElementById("api-calls").textContent =
                    stats.totalRequests || 0;
                document.getElementById("unique-sessions").textContent = "0"; // Placeholder
                document.getElementById("daily-breeds").textContent =
                    stats.breedsViewed || 0;

                // Popular breeds
                const popularBreeds = document.getElementById("popular-breeds");
                if (stats.popularBreeds && stats.popularBreeds.length > 0) {
                    popularBreeds.innerHTML = stats.popularBreeds
                        .slice(0, 3)
                        .map(
                            (breed, index) =>
                                `<strong>#${index + 1}</strong> ${breed.name || breed}<br>`,
                        )
                        .join("");
                } else {
                    popularBreeds.innerHTML =
                        "<strong>Loading...</strong> data";
                }
            }

            // Initialize statistics on page load
            document.addEventListener("DOMContentLoaded", function () {
                loadLiveStatistics();
                // Refresh statistics every 30 seconds
                setInterval(loadLiveStatistics, 30000);
            });

            // Load Demo Data
            async function loadDemoData() {
                const dogResults = document.getElementById("dogResults");

                if (!dogResults) {
                    console.error("dogResults element not found!");
                    return;
                }

                console.log("Loading demo data...");

                // Show loading state
                dogResults.innerHTML = `
                    <div class="loading">
                        <i class="fas fa-spinner"></i>
                        <p>Loading dog breeds...</p>
                    </div>
                `;

                try {
                    // Check manual API connection toggle first
                    if (!apiConnected) {
                        throw new Error("API manually disconnected");
                    }

                    console.log("Fetching breeds from API...");
                    const response = await fetch("/.netlify/functions/breeds");
                    if (!response.ok) throw new Error("Failed to fetch breeds");

                    const data = await response.json();
                    console.log("API Response:", data);

                    // Handle new API format - data.data is array of breed objects
                    if (data.success && data.data && Array.isArray(data.data)) {
                        // Convert array to object format for compatibility
                        breedData = {};
                        data.data.forEach((breed) => {
                            breedData[breed.breed] = breed.subBreed
                                ? [breed.subBreed]
                                : [];
                        });
                    } else {
                        // Fallback for old format
                        breedData = data.message || {};
                    }

                    console.log(
                        "Fetched breeds:",
                        Object.keys(breedData).length,
                    );

                    // If no breeds from our API, fetch directly from Dog CEO API
                    if (Object.keys(breedData).length === 0) {
                        console.log(
                            "No breeds from our API, fetching from Dog CEO API directly...",
                        );
                        const dogApiResponse = await fetch(
                            "https://dog.ceo/api/breeds/list/all",
                        );
                        if (dogApiResponse.ok) {
                            const dogApiData = await dogApiResponse.json();
                            if (dogApiData.status === "success") {
                                breedData = dogApiData.message;
                                console.log(
                                    "Fetched from Dog CEO API:",
                                    Object.keys(breedData).length,
                                    "breeds",
                                );
                            }
                        }
                    }

                    // Store all breeds for pagination
                    allBreeds = Object.keys(breedData);
                    filteredBreeds = [...allBreeds];
                    console.log("Total breeds available:", allBreeds.length);

                    // Show pagination controls if we have more than 12 breeds
                    if (allBreeds.length > breedsPerPage) {
                        document.getElementById(
                            "paginationControls",
                        ).style.display = "block";
                        updatePaginationInfo();
                    }

                    // Get first page of breeds
                    const breeds = getCurrentPageBreeds();
                    console.log("Selected breeds for demo:", breeds);
                    const dogCards = await Promise.all(
                        breeds.map(async (breed) => {
                            try {
                                console.log(
                                    `Fetching image for breed: ${breed}`,
                                );
                                const imageResponse = await fetch(
                                    `/.netlify/functions/random?breed=${breed}`,
                                );

                                if (!imageResponse.ok) {
                                    throw new Error(
                                        `HTTP ${imageResponse.status}`,
                                    );
                                }

                                const imageData = await imageResponse.json();
                                console.log(
                                    `Image data for ${breed}:`,
                                    imageData,
                                );

                                // Handle new API format
                                let imageUrl =
                                    "https://via.placeholder.com/300x250?text=No+Image";
                                if (imageData.success && imageData.data) {
                                    imageUrl =
                                        imageData.data.url ||
                                        imageData.data.message ||
                                        imageUrl;
                                } else if (imageData.message) {
                                    // Fallback for Dog CEO API direct format
                                    imageUrl = imageData.message;
                                } else {
                                    // Final fallback - try Dog CEO API directly
                                    console.log(
                                        `Trying Dog CEO API directly for ${breed}`,
                                    );
                                    const directResponse = await fetch(
                                        `https://dog.ceo/api/breed/${breed}/images/random`,
                                    );
                                    if (directResponse.ok) {
                                        const directData =
                                            await directResponse.json();
                                        if (directData.status === "success") {
                                            imageUrl = directData.message;
                                        }
                                    }
                                }

                                console.log(
                                    `Final image URL for ${breed}: ${imageUrl}`,
                                );

                                return `
                                <div class="dog-card" onclick="showBreedModal('${breed}')">
                                    <img src="${imageUrl}" alt="${breed}" class="dog-image" onerror="this.src='https://via.placeholder.com/300x250?text=No+Image'">
                                    <div class="dog-info">
                                        <h3 class="dog-name">${breed}</h3>
                                    </div>
                                </div>
                            `;
                            } catch (error) {
                                console.warn(
                                    `Failed to load image for ${breed}:`,
                                    error,
                                );
                                return `
                                <div class="dog-card">
                                    <img src="https://via.placeholder.com/300x250?text=No+Image" alt="${breed}" class="dog-image">
                                    <div class="dog-info">
                                        <h3 class="dog-name">${breed}</h3>
                                    </div>
                                </div>
                            `;
                            }
                        }),
                    );

                    dogResults.innerHTML = dogCards.join("");
                    console.log(
                        "Demo cards loaded successfully:",
                        dogCards.length,
                        "cards",
                    );
                    console.log(
                        "HTML content length:",
                        dogResults.innerHTML.length,
                    );
                } catch (error) {
                    const isManualDisconnect = !apiConnected;
                    console.error("API error:", error);
                    console.log(
                        isManualDisconnect
                            ? "API manually disconnected, showing fallback..."
                            : "Loading offline demo dogs...",
                    );

                    // Show offline demo with fallback data
                    const offlineNotice = `
                        <div class="offline-notice">
                            <strong>📡 ${isManualDisconnect ? "API Manually Disconnected" : "Offline Demo Mode"}</strong><br>
                            ${isManualDisconnect ? "API connection disabled to demonstrate fallback system. Showing demo dog breeds." : "API is currently offline. Showing demo dog breeds."}
                            <span onclick="loadDemoData()" class="retry-btn-isolated-unique">
                                🔄 Retry
                            </span>
                        </div>
                    `;

                    const offlineDogCards = offlineDogData
                        .map(
                            (dog) => `
                        <div class="dog-card" onclick="showBreedModal('${dog.name}')">
                            <img src="${dog.image}" alt="${dog.name}" class="dog-image" onerror="this.src='https://via.placeholder.com/300x250?text=${dog.name}'">
                            <div class="dog-info">
                                <h3 class="dog-name">${dog.name}</h3>
                            </div>
                        </div>
                    `,
                        )
                        .join("");

                    dogResults.innerHTML = offlineNotice + offlineDogCards;
                    console.log(
                        "Offline demo cards loaded:",
                        offlineDogData.length,
                        "cards",
                    );

                    // Set up offline breed data for modal
                    breedData = {};
                    offlineDogData.forEach((dog) => {
                        breedData[dog.name] = [];
                    });

                    allBreeds = Object.keys(breedData);
                    filteredBreeds = [...allBreeds];
                    currentPage = 1;

                    console.log(
                        "Offline breed data set up:",
                        Object.keys(breedData),
                    );
                }
            }

            // Show Breed Modal
            async function showBreedModal(breed) {
                const modal = document.getElementById("dogModal");
                const modalTitle = document.getElementById("modalTitle");
                const modalContent = document.getElementById("modalContent");

                modalTitle.textContent = breed;
                modalContent.innerHTML = `
                <div class="loading">
                    <i class="fas fa-spinner"></i>
                    <p>Loading more ${breed} images...</p>
                </div>
            `;

                modal.style.display = "block";

                try {
                    const response = await fetch(
                        `/.netlify/functions/random?breed=${breed}&count=8`,
                    );
                    const data = await response.json();
                    console.log("Modal API response:", data);

                    let images = [];

                    // Handle new API format
                    if (data.success && data.data) {
                        if (Array.isArray(data.data)) {
                            // Multiple images
                            images = data.data.map(
                                (img) => img.url || img.message || img,
                            );
                        } else if (data.data.url) {
                            // Single image object
                            images = [data.data.url];
                        }
                    } else if (Array.isArray(data.message)) {
                        // Fallback for old format - multiple images
                        images = data.message;
                    } else if (data.message) {
                        // Fallback for old format - single image
                        images = [data.message];
                    }

                    // If still no images, try Dog CEO API directly
                    if (images.length === 0) {
                        console.log(
                            "No images from our API, trying Dog CEO API directly...",
                        );
                        const directResponse = await fetch(
                            `https://dog.ceo/api/breed/${breed}/images`,
                        );
                        if (directResponse.ok) {
                            const directData = await directResponse.json();
                            if (
                                directData.status === "success" &&
                                Array.isArray(directData.message)
                            ) {
                                images = directData.message.slice(0, 8); // Limit to 8 images
                            }
                        }
                    }

                    if (images.length === 0) {
                        throw new Error("No images found");
                    }

                    console.log("Modal images found:", images.length);

                    const imageGrid = images
                        .map(
                            (img) => `
                    <img src="${img}" alt="${breed}" class="breed-image" onerror="this.style.display='none'">
                `,
                        )
                        .join("");

                    modalContent.innerHTML = `
                    <div class="breed-images">
                        ${imageGrid}
                    </div>
                `;
                } catch (error) {
                    // Show offline mode with fallback images
                    console.log(
                        "API is offline, showing demo images for",
                        breed,
                    );

                    const offlineImages = getOfflineImages(breed);

                    if (offlineImages.length > 0) {
                        const imageGrid = offlineImages
                            .map(
                                (img) => `
                        <img src="${img}" alt="${breed}" class="breed-image" onerror="this.style.display='none'">
                    `,
                            )
                            .join("");

                        modalContent.innerHTML = `
                            <div class="offline-notice-modal">
                                <strong>📡 Offline Demo Mode</strong> - Showing sample images
                            </div>
                            <div class="breed-images">
                                ${imageGrid}
                            </div>
                        `;
                    } else {
                        modalContent.innerHTML = `
                        <div class="error-message">
                            <h3>⚠️ Error Loading Images</h3>
                            <p>Failed to load more images for ${breed}.</p>
                        </div>
                    `;
                    }
                }
            }

            // Get offline images for breed
            function getOfflineImages(breed) {
                const offlineImageSets = {
                    poodle: [
                        "https://images.dog.ceo/breeds/poodle-standard/n02113799_1050.jpg",
                        "https://images.dog.ceo/breeds/poodle-miniature/n02113712_4913.jpg",
                        "https://images.dog.ceo/breeds/poodle-toy/n02113624_1444.jpg",
                        "https://images.dog.ceo/breeds/poodle-standard/n02113799_4708.jpg",
                    ],
                    labrador: [
                        "https://images.dog.ceo/breeds/labrador/n02099712_2252.jpg",
                        "https://images.dog.ceo/breeds/labrador/n02099712_6321.jpg",
                        "https://images.dog.ceo/breeds/labrador/n02099712_1742.jpg",
                        "https://images.dog.ceo/breeds/labrador/n02099712_4396.jpg",
                    ],
                    spaniel: [
                        "https://images.dog.ceo/breeds/spaniel-cocker/n02102318_4582.jpg",
                        "https://images.dog.ceo/breeds/spaniel-english/n02102480_7094.jpg",
                        "https://images.dog.ceo/breeds/spaniel-irish/n02102973_1438.jpg",
                        "https://images.dog.ceo/breeds/spaniel-cocker/n02102318_7026.jpg",
                    ],
                };

                return offlineImageSets[breed] || [];
            }

            // Pagination Functions
            function getCurrentPageBreeds() {
                const startIndex = (currentPage - 1) * breedsPerPage;
                const endIndex = startIndex + breedsPerPage;
                return filteredBreeds.slice(startIndex, endIndex);
            }

            function goToPage(pageNumber) {
                const totalPages = Math.ceil(
                    filteredBreeds.length / breedsPerPage,
                );
                if (pageNumber >= 1 && pageNumber <= totalPages) {
                    currentPage = pageNumber;
                    loadCurrentPage();
                    updatePaginationInfo();
                }
            }

            function searchBreeds() {
                const searchTerm = document
                    .getElementById("searchInput")
                    .value.toLowerCase();

                if (searchTerm === "") {
                    filteredBreeds = [...allBreeds];
                } else {
                    filteredBreeds = allBreeds.filter((breed) =>
                        breed.toLowerCase().includes(searchTerm),
                    );
                }

                currentPage = 1;
                loadCurrentPage();
                updatePaginationInfo();
            }

            function clearSearch() {
                document.getElementById("searchInput").value = "";
                filteredBreeds = [...allBreeds];
                currentPage = 1;
                loadCurrentPage();
                updatePaginationInfo();
            }

            async function loadCurrentPage() {
                const dogResults = document.getElementById("dogResults");
                const breeds = getCurrentPageBreeds();

                // Show loading
                dogResults.innerHTML = `
                    <div class="loading">
                        <i class="fas fa-spinner"></i>
                        <p>Loading page ${currentPage}...</p>
                    </div>
                `;

                try {
                    const dogCards = await Promise.all(
                        breeds.map(async (breed) => {
                            try {
                                const imageResponse = await fetch(
                                    `/.netlify/functions/random?breed=${breed}`,
                                );

                                if (!imageResponse.ok) {
                                    throw new Error(
                                        `HTTP ${imageResponse.status}`,
                                    );
                                }

                                const imageData = await imageResponse.json();

                                let imageUrl =
                                    "https://via.placeholder.com/300x250?text=No+Image";
                                if (imageData.success && imageData.data) {
                                    imageUrl =
                                        imageData.data.url ||
                                        imageData.data.message ||
                                        imageUrl;
                                } else if (imageData.message) {
                                    imageUrl = imageData.message;
                                } else {
                                    const directResponse = await fetch(
                                        `https://dog.ceo/api/breed/${breed}/images/random`,
                                    );
                                    if (directResponse.ok) {
                                        const directData =
                                            await directResponse.json();
                                        if (directData.status === "success") {
                                            imageUrl = directData.message;
                                        }
                                    }
                                }

                                return `
                                    <div class="dog-card" onclick="showBreedModal('${breed}')">
                                        <img src="${imageUrl}" alt="${breed}" class="dog-image" onerror="this.src='https://via.placeholder.com/300x250?text=No+Image'">
                                        <div class="dog-info">
                                            <h3 class="dog-name">${breed}</h3>
                                        </div>
                                    </div>
                                `;
                            } catch (error) {
                                return `
                                    <div class="dog-card">
                                        <img src="https://via.placeholder.com/300x250?text=No+Image" alt="${breed}" class="dog-image">
                                        <div class="dog-info">
                                            <h3 class="dog-name">${breed}</h3>
                                        </div>
                                    </div>
                                `;
                            }
                        }),
                    );

                    dogResults.innerHTML = dogCards.join("");
                } catch (error) {
                    console.error("Error loading page:", error);
                    dogResults.innerHTML = `
                        <div class="error-message">
                            <h3>⚠️ Error Loading Page</h3>
                            <p>Failed to load breeds for page ${currentPage}.</p>
                        </div>
                    `;
                }
            }

            function updatePaginationInfo() {
                const totalBreeds = filteredBreeds.length;
                const totalPages = Math.ceil(totalBreeds / breedsPerPage);
                const startIndex = (currentPage - 1) * breedsPerPage + 1;
                const endIndex = Math.min(
                    currentPage * breedsPerPage,
                    totalBreeds,
                );

                // Update info text
                const searchTerm = document.getElementById("searchInput").value;
                const infoText = searchTerm
                    ? `Showing ${startIndex}-${endIndex} of ${totalBreeds} breeds (filtered from ${allBreeds.length} total)`
                    : `Showing breeds ${startIndex}-${endIndex} of ${totalBreeds}`;

                document.getElementById("paginationInfo").textContent =
                    infoText;

                // Update page numbers - show ALL page numbers
                const pageNumbers = document.getElementById("pageNumbers");
                let pageNumbersHTML = "";

                for (let i = 1; i <= totalPages; i++) {
                    pageNumbersHTML += `
                        <button class="page-number ${i === currentPage ? "active" : ""}"
                                onclick="goToPage(${i})">${i}</button>
                    `;
                }

                pageNumbers.innerHTML = pageNumbersHTML;
            }

            // Close modal
            function closeModal() {
                document.getElementById("dogModal").style.display = "none";
            }

            // Close modal when clicking outside
            window.onclick = function (event) {
                const modal = document.getElementById("dogModal");
                if (event.target === modal) {
                    closeModal();
                }
            };

            // Update API Status
            async function updateApiStatus() {
                const statusDot = document.getElementById("statusDot");
                const statusText = document.getElementById("statusText");
                const toggleButton = document.getElementById("apiToggle");

                // Check if API is manually disconnected
                if (!apiConnected) {
                    statusDot.className = "status-dot offline";
                    statusText.textContent = "API Offline";
                    return;
                }

                // Set loading state
                statusDot.className = "status-dot loading";
                statusText.textContent = "Checking API connection...";

                try {
                    const response = await fetch("/.netlify/functions/health");
                    if (response.ok) {
                        const data = await response.json();
                        statusDot.className = "status-dot online";
                        statusText.textContent = `${data.service || "Barkend API"} Connected`;
                        toggleButton.classList.add("connected");
                    } else {
                        throw new Error("API health check failed");
                    }
                } catch (error) {
                    statusDot.className = "status-dot offline";
                    statusText.textContent = "API Offline";
                    toggleButton.classList.remove("connected");
                }
            }

            // Initialize app
            document.addEventListener("DOMContentLoaded", function () {
                console.log("Barkend initialized");

                // Initialize API toggle button state - start as disconnected since no backend
                const toggleButton = document.getElementById("apiToggle");
                if (toggleButton) {
                    toggleButton.classList.add("disconnected");
                }

                updateApiStatus();
                // Update API status every 30 seconds
                setInterval(updateApiStatus, 30000);
            });
        </script>
    </body>
</html>
