<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Barkend API Documentation</title>
    <link rel="stylesheet" type="text/css" href="https://unpkg.com/swagger-ui-dist@4.15.5/swagger-ui.css" />
    <link rel="icon" type="image/png" href="https://petco.scene7.com/is/image/PETCO/dog-category-090121-369w-269h-hero-cutout-d?fmt=png-alpha" sizes="32x32" />
    <style>
        html {
            box-sizing: border-box;
            overflow: -moz-scrollbars-vertical;
            overflow-y: scroll;
        }

        *, *:before, *:after {
            box-sizing: inherit;
        }

        body {
            margin: 0;
            background: #fafafa;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .swagger-ui .topbar {
            background-color: #2563eb;
            background-image: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .swagger-ui .topbar .download-url-wrapper .select-label {
            color: #fff;
        }

        .swagger-ui .topbar .download-url-wrapper input[type=text] {
            border: 2px solid #fff;
            border-radius: 4px;
        }

        .swagger-ui .topbar .download-url-wrapper .download-url-button {
            background: #fff;
            color: #2563eb;
            border: 2px solid #fff;
            border-radius: 4px;
            font-weight: 600;
        }

        .swagger-ui .topbar .download-url-wrapper .download-url-button:hover {
            background: #f1f5f9;
        }

        .swagger-ui .info .title {
            color: #2563eb;
        }

        .swagger-ui .scheme-container {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 10px;
            margin: 20px 0;
        }

        .custom-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
            margin-bottom: 0;
        }

        .custom-header h1 {
            margin: 0;
            font-size: 2.5rem;
            font-weight: 700;
        }

        .custom-header p {
            margin: 10px 0 0 0;
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .custom-footer {
            background: #1e293b;
            color: white;
            text-align: center;
            padding: 20px;
            margin-top: 40px;
        }

        .custom-footer a {
            color: #60a5fa;
            text-decoration: none;
        }

        .custom-footer a:hover {
            text-decoration: underline;
        }

        #swagger-ui {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .swagger-ui .info .markdown p {
            font-size: 16px;
            line-height: 1.6;
        }

        .swagger-ui .btn.authorize {
            background: #10b981;
            border-color: #10b981;
        }

        .swagger-ui .btn.authorize:hover {
            background: #059669;
            border-color: #059669;
        }

        .loading-container {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 200px;
            flex-direction: column;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #e2e8f0;
            border-top: 4px solid #2563eb;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error-container {
            background: #fef2f2;
            border: 1px solid #fecaca;
            color: #991b1b;
            padding: 20px;
            border-radius: 8px;
            margin: 20px;
            text-align: center;
        }

        .error-container h3 {
            margin-top: 0;
        }

        .status-badge {
            display: inline-block;
            background: #10b981;
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 10px;
        }

        .status-badge.offline {
            background: #ef4444;
        }
    </style>
</head>
<body>
    <div class="custom-header">
        <h1>üêï Barkend API Documentation</h1>
        <p>Comprehensive RESTful API for dog breed information and images</p>
        <span id="api-status" class="status-badge">Checking...</span>
    </div>

    <div id="swagger-ui">
        <div class="loading-container">
            <div class="loading-spinner"></div>
            <p>Loading API documentation...</p>
        </div>
    </div>

    <div class="custom-footer">
        <p>&copy; 2025 Barkend API. Built with ‚ù§Ô∏è for dog lovers everywhere.</p>
        <p>
            <a href="/">‚Üê Back to Main App</a> |
            <a href="/.netlify/functions/health">API Health</a> |
            <a href="https://github.com/yourusername/barkend">GitHub</a>
        </p>
    </div>

    <script src="https://unpkg.com/swagger-ui-dist@4.15.5/swagger-ui-bundle.js"></script>
    <script src="https://unpkg.com/swagger-ui-dist@4.15.5/swagger-ui-standalone-preset.js"></script>
    <script>
        // Check API status
        async function checkApiStatus() {
            const statusElement = document.getElementById('api-status');
            try {
                const response = await fetch('/.netlify/functions/health');
                if (response.ok) {
                    const data = await response.json();
                    statusElement.textContent = `API Online - ${data.service}`;
                    statusElement.className = 'status-badge';
                } else {
                    throw new Error('API response not ok');
                }
            } catch (error) {
                statusElement.textContent = 'API Offline';
                statusElement.className = 'status-badge offline';
            }
        }

        // Initialize Swagger UI
        async function initSwaggerUI() {
            try {
                // Get the API spec
                const specUrl = '/.netlify/functions/swagger-spec';
                const response = await fetch(specUrl);

                if (!response.ok) {
                    throw new Error(`Failed to load API spec: ${response.status}`);
                }

                const spec = await response.json();

                // Initialize Swagger UI
                const ui = SwaggerUIBundle({
                    spec: spec,
                    dom_id: '#swagger-ui',
                    deepLinking: true,
                    presets: [
                        SwaggerUIBundle.presets.apis,
                        SwaggerUIStandalonePreset
                    ],
                    plugins: [
                        SwaggerUIBundle.plugins.DownloadUrl
                    ],
                    layout: "StandaloneLayout",
                    validatorUrl: null,
                    tryItOutEnabled: true,
                    supportedSubmitMethods: ['get', 'post', 'put', 'delete', 'patch'],
                    onComplete: function() {
                        console.log('Barkend API documentation loaded successfully');
                    },
                    onFailure: function(error) {
                        console.error('Failed to load Swagger UI:', error);
                        showError('Failed to initialize API documentation');
                    },
                    docExpansion: 'list',
                    filter: true,
                    showRequestHeaders: true,
                    showCommonExtensions: true,
                    requestInterceptor: function(request) {
                        // Add any custom headers if needed
                        request.headers['Accept'] = 'application/json';
                        return request;
                    },
                    responseInterceptor: function(response) {
                        // Log responses for debugging
                        console.log('API Response:', response.status, response.url);
                        return response;
                    }
                });

                // Add custom styling after initialization
                setTimeout(() => {
                    addCustomStyling();
                }, 1000);

            } catch (error) {
                console.error('Error initializing Swagger UI:', error);
                showError('Failed to load API documentation. Please check if the API is running.');
            }
        }

        function showError(message) {
            document.getElementById('swagger-ui').innerHTML = `
                <div class="error-container">
                    <h3>‚ö†Ô∏è Error Loading Documentation</h3>
                    <p>${message}</p>
                    <p>
                        <strong>Troubleshooting:</strong><br>
                        ‚Ä¢ Check if the API is running<br>
                        ‚Ä¢ Verify the Swagger spec endpoint<br>
                        ‚Ä¢ Check browser console for errors
                    </p>
                    <button onclick="window.location.reload()" style="
                        background: #2563eb;
                        color: white;
                        border: none;
                        padding: 10px 20px;
                        border-radius: 4px;
                        cursor: pointer;
                        margin-top: 10px;
                    ">
                        üîÑ Retry
                    </button>
                </div>
            `;
        }

        function addCustomStyling() {
            // Add custom classes and styling after Swagger UI loads
            const info = document.querySelector('.swagger-ui .info');
            if (info) {
                const dogEmoji = document.createElement('div');
                dogEmoji.innerHTML = 'üêïü¶Æüêï‚Äçü¶∫';
                dogEmoji.style.fontSize = '2rem';
                dogEmoji.style.textAlign = 'center';
                dogEmoji.style.marginBottom = '20px';
                info.insertBefore(dogEmoji, info.firstChild);
            }

            // Customize operation tags
            const operationTags = document.querySelectorAll('.swagger-ui .opblock-tag');
            operationTags.forEach(tag => {
                const tagText = tag.textContent.trim();
                let emoji = '';
                switch(tagText) {
                    case 'System':
                        emoji = '‚öôÔ∏è ';
                        break;
                    case 'Breeds':
                        emoji = 'üêï ';
                        break;
                    case 'Images':
                        emoji = 'üì∏ ';
                        break;
                    case 'Favorites':
                        emoji = '‚ù§Ô∏è ';
                        break;
                }
                if (emoji) {
                    tag.innerHTML = emoji + tag.innerHTML;
                }
            });
        }

        // Initialize everything when page loads
        document.addEventListener('DOMContentLoaded', function() {
            checkApiStatus();
            initSwaggerUI();

            // Refresh API status every 30 seconds
            setInterval(checkApiStatus, 30000);
        });

        // Handle page visibility changes
        document.addEventListener('visibilitychange', function() {
            if (!document.hidden) {
                checkApiStatus();
            }
        });
    </script>
</body>
</html>
